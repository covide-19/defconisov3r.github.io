<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>

<div class="container">

    <h1 class="text-center pt-5">Do I have COVID-19?</h1>

    <p class="description text-center mt-3">Just answer 7 questions based on info from the U.S. Center for Disease Control (CDC) and World Health Organization (WHO)! <br>(Last updated: <span data-date="" id="last_updated"></span>)</p>

    <div class="test row justify-content-center">
        <div class="col-md-12 col-lg-8">
            <div class="buttons">
                <button class="back"><img src="./img/left.png" class="arrow"> Back</button>
                <button class="next">Next <img src="./img/left.png" class="arrow right"></button>
            </div>

            <div class="alert alert-danger mt-3" id="error" role="alert">
                Select the answer
            </div>

            <div class="step" data-id="1" id="step-1">
                <h2 class="step-title">1. Are you the patient?</h2>

                <button class="answer-btn">Yes – I’m answering these questions for myself</button>
                <button class="answer-btn">No – I’m answering these questions for someone else</button>
            </div>

            <div class="step" data-id="2" id="step-2">
                <h2 class="step-title">2. Are you male or female</h2>

                <button class="answer-btn">Male</button>
                <button class="answer-btn">Female</button>
                <button class="answer-btn">Decline to State / Non-Binary</button>
            </div>

            <div class="step" data-id="3" id="step-3">
                <h2 class="step-title">3. What is your age?</h2>

                <button data-index="0" class="answer-btn">0 to 9 years old</button>
                <button data-index="1" class="answer-btn">10 to 19 years old</button>
                <button data-index="2" class="answer-btn">20 to 29 years old</button>
                <button data-index="3" class="answer-btn">30 to 39 years old</button>
                <button data-index="4" class="answer-btn">40 to 49 years old</button>
                <button data-index="5" class="answer-btn">50 to 59 years old</button>
                <button data-index="6" class="answer-btn">60 to 69 years old</button>
                <button data-index="7" class="answer-btn">70 to 79 years old</button>
                <button data-index="8" class="answer-btn">80+ years old</button>
            </div>

            <div class="step" data-id="4" id="step-4">
                <h2 class="step-title">4. Do you have a fever?</h2>

                <button data-index="0"  class="answer-btn">Yes</button>
                <button data-index="1"  class="answer-btn">Maybe</button>
                <button data-index="2"  class="answer-btn">No</button>

                <div class="additional-input">If so, how many days ago did it start? (optional) <input class="number" type="number"></div>
            </div>

            <div class="step" data-id="5" id="step-5">
                <h2 class="step-title">5. Do you have a dry cough?</h2>

                <button data-index="0" class="answer-btn">Yes</button>
                <button data-index="1" class="answer-btn">Maybe</button>
                <button data-index="2" class="answer-btn">No</button>

                <div class="additional-input">If so, how many days ago did it start? (optional) <input class="number" type="number"></div>
            </div>

            <div class="step" data-id="6" id="step-6">
                <h2 class="step-title">6. Do you have shortness of breath?</h2>

                <button data-index="0" class="answer-btn">Yes</button>
                <button data-index="1" class="answer-btn">Maybe</button>
                <button data-index="2" class="answer-btn">No</button>

                <div class="additional-input">If so, how many days ago did it start? (optional) <input class="number" type="number"></div>
            </div>

            <div class="step" data-id="7" id="step-7">
                <h2 class="step-title">7. Select any other symptoms that apply:</h2>

                <div class="radio-wrap">
                    <p>
                        <input type="checkbox" id="radio-71" name="radio-group" value="Difficulty Breathing">
                        <label for="radio-71">Difficulty Breathing</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-72" name="radio-group" value="Persistent pain or pressure in your chest">
                        <label for="radio-72">Persistent pain or pressure in your chest</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-73" name="radio-group" value="New confusion or inability to arouse">
                        <label for="radio-73">New confusion or inability to arouse</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-74" name="radio-group" value="Bluish lips or face">
                        <label for="radio-74">Bluish lips or face</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-75" name="radio-group" value="Aches and pains">
                        <label for="radio-75">Aches and pains</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-76" name="radio-group" value="Nasal congestion">
                        <label for="radio-76">Nasal congestion</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-77" name="radio-group" value="Runny Nose">
                        <label for="radio-77">Runny Nose</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-78" name="radio-group" value="Sore throat">
                        <label for="radio-78">Sore throat</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-79" name="radio-group" value="Diarrhea">
                        <label for="radio-79">Diarrhea</label>
                    </p>
                    <p>
                        <input type="checkbox" id="radio-710" name="radio-group" value="None of the above">
                        <label for="radio-710">None of the above</label>
                    </p>
                </div>

                <div class="additional-input">If so, how many days ago did it start? (optional) <input class="number" type="number"></div>
            </div>

            <div class="step" data-id="8" id="step-8">
                <h2 class="step-title">Other Symptoms? Comments? (Optional)</h2>

                <textarea id="comments" placeholder="(Enter up to 500 characters)" maxlength="500" rows="5"></textarea>

                <!--<div class="row mt-2">-->
                    <!--<div class="col-md-4">Your Email (Optional):</div>-->
                    <!--<div class="col-md-8"><input type="email" id="email"></div>-->
                <!--</div>-->

                <button id="get-results">Get My Result!</button>

                <p class="agreement">By clicking “Get My Result” I agree to allow my anonymized responses to be used for research purposes</p>
            </div>

            <div class="step" data-id="9" id="step-9">
                <h2 class="step-title">Results</h2>

                <div class="scenario-1">
                    <p>No symptoms associated with COVID-19.</p>
                </div>

                <div class="scenario-2">
                    <p><span class="caregiver">Respondent</span><span class="patient">Patient</span> has some emergency warning sign(s) for COVID-19:</p>
                    <ul class="symptoms"></ul>

                    <p>Get medical attention immediately!</p>
                </div>

                <div class="scenario-3">
                    <p><span class="caregiver">Respondent</span><span class="patient">Patient</span> has <span class="numbers"></span> U.S. CDC-acknowledged symptom(s) associated with COVID-19.</p>
                </div>

                <div class="scenario-4">
                    <p><span class="caregiver">Respondent</span><span class="patient">Patient</span> has zero (0) U.S. CDC-acknowledged symptoms associated with COVID-19.</p>
                </div>

                <table id="result-table" class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Symptom</th>
                            <th>Response</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Fever</td>
                            <td>No</td>
                        </tr>
                        <tr>
                            <td>Dry Cough</td>
                            <td>No</td>
                        </tr>
                        <tr>
                            <td>Shortness of Breath</td>
                            <td>No</td>
                        </tr>
                        <tr>
                            <td>Emergency Warning Signs</td>
                            <td>No</td>
                        </tr>
                        <tr>
                            <td>
                                Other Symptoms<span class="colon">:</span>
                                <ul>
                                </ul>
                            </td>
                            <td>No</td>
                        </tr>
                    </tbody>
                </table>

                <div class="scenario-1 mt-3">
                    <p>While the <span class="caregiver">respondent</span><span class="patient">patient</span> does not show symptoms of COVID-19 according to CDC.gov,
                        the symptoms reviewed on this website are not all inclusive.
                        Please consult <span class="caregiver">your</span><span class="patient">a</span> medical provider for any other symptom that is severe or concerning. (<a href="./sources.html" target="_blank">Sources</a>)</p>
                </div>

                <div class="scenario-2 mt-3">
                    <p>(<a href="./sources.html" target="_blank">Sources</a>)</p>
                </div>

                <div class="scenario-3 mt-3">
                    <p><span class="caregiver">Stay</span><span class="patient">Patient should stay</span> home and speak to <span class="caregiver">your</span><span class="patient">his/her</span> healthcare provider if <span class="caregiver">you have</span><span class="patient">he/she has</span> been in close contact with a person known to have COVID-19 or live in or have recently traveled from an area with ongoing spread of COVID-19. (<a href="./sources.html" target="_blank">Sources</a>)</p>

                    <p>(Do I live in a location with ongoing spread of COVID-19? <a target="_blank" href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">Click here</a> to find out)</p>
                </div>

                <div class="scenario-4 mt-3">
                    <p class="other-options">The World Health Organization (WHO) notes that some COVID-19 patients may have aches and pains, nasal congestion, runny nose, sore throat or diarrhea. </p>

                    <p><span class="caregiver">Stay</span><span class="patient">Patient should stay</span> home and speak to <span class="caregiver">your</span><span class="patient">his/her</span> healthcare provider if <span class="caregiver">you have</span><span class="patient">he/she has</span> been in close contact with a person known to have COVID-19 or live in or have recently traveled from an area with ongoing spread of COVID-19. (<a href="./sources.html" target="_blank">Sources</a>)</p>

                    <p>(Do I live in a location with ongoing spread of COVID-19? <a target="_blank"  href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">Click here</a> to find out)</p>
                </div>

                <p class="disclamer">Disclaimer 1: The symptoms reviewed on this website are not all inclusive. Please consult your medical provider for any other symptom that is severe or concerning.</p>
                <p class="disclamer">Disclaimer 2: Free-write responses were not considered as an input to this result; this website functionality is still under development.</p>


                <div class="infografics">
                    <p><b>Comparison of Symptoms to Real-Life Family with COVID-19</b></p>

                    <p>Dr. Chan et. al., reported on detailed symptoms experienced by an extended family that tested positive for COVID-19 at the University of Hong Kong-Shenzhen Hospital. The symptoms of the Father, Mother, Mother-in-Law, Daughter, and Son-in-Law are listed below.</p>

                    <p>The family members experienced their first symptoms on different days, but this infographic aligns their first day of symptoms so we can view how the symptoms appeared over time for the various family members.</p>

                    <p class="has_symptoms">Your symptoms are depicted in the top row, to allow you to compare your symptoms to each of these family members.</p>

                    <p class="has_not_symptoms">If you retake the survey to include days, this infographic can list your symptoms in the top row, to allow you to compare your symptoms to each of these family members.</p>

                    <div class="infografic" id="user-infografic">
                        <div class="infografic-wrap">
                            <table style="margin-top: 20px;">
                                <tr>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <p class="other-symptoms mt-2"></p>

                    <div class="infografic">
                        <div class="infografic-wrap">
                            <div class="text" style="left: 167px;height: 64px;">
                                <div class="line">Fever</div>
                                <div class="line">Generalized weakness</div>
                            </div>
                            <div class="text"  style="left: 196px;">
                                <div class="line">Dry cough</div>
                            </div>

                            <div class="text" style="left: 347px;">
                                <div class="line">Persistent symptoms</div>
                            </div>

                            <table style="margin-top: 100px;">
                                <tr>
                                    <td>Father (66)</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td>8</td>
                                    <td>9</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="infografic">
                        <div class="infografic-wrap">
                            <div class="text" style="left: 167px;height: 64px;">
                                <div class="line">Fever</div>
                                <div class="line">Generalized weakness</div>
                                <div class="line">Dry cough</div>
                            </div>
                            <div class="text" style="left: 377px;">
                                <div class="line">Persistent symptoms</div>
                            </div>

                            <table style="margin-top: 100px;">
                                <tr>
                                    <td>Mother (65)</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td>8</td>
                                    <td>9</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="infografic">
                        <div class="infografic-wrap">
                            <div class="text" style="left: 167px;height: 64px;">
                                <div class="line">Generalized weakness</div>
                                <div class="line">Back pain</div>
                            </div>
                            <div class="text" style="left: 288px; height: 38px;">
                                <div class="line">Fever</div>
                                <div class="line">Dry cough</div>
                            </div>

                            <table style="margin-top: 100px;">
                                <tr>
                                    <td>Mother-in-low (63)</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td>8</td>
                                    <td>9</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="infografic">
                        <div class="infografic-wrap">
                            <div class="text" style="left: 167px;height: 41px;">
                                <div class="line">Fever</div>
                                <div class="line">Diarrhea</div>
                            </div>
                            <div class="text" style="left: 377px;">
                                <div class="line">Sharp chest pain</div>
                            </div>

                            <table style="margin-top: 100px;">
                                <tr>
                                    <td>Daughter (37)</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td>8</td>
                                    <td>9</td>
                                </tr>
                            </table>
                            <div class="asterisk">*</div>
                        </div>
                    </div>

                    <div class="infografic">
                        <div class="infografic-wrap">
                            <div class="text" style="left: 167px;height: 41px;">
                                <div class="line">Fever</div>
                                <div class="line">Diarrhea</div>
                            </div>
                            <div class="text" style="left: 288px;height: 41px;">
                                <div class="line">Productive cough</div>
                                <div class="line">Runny nose</div>
                            </div>

                            <table style="margin-top: 100px;">
                                <tr>
                                    <td>Son-in-law (36)</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td>8</td>
                                    <td>9</td>
                                </tr>
                            </table>
                            <div class="asterisk">**</div>
                        </div>
                    </div>

                    <p class="mt-2">* Daughter also has nasal congestion and sore throat</p>
                    <p>** Son-in-law also has sneezing</p>

                    <p>Source:</p>

                    <p>Chan  JF-W, Yuan  S, Kok  K-H,  et al.  A familial cluster of pneumonia associated with the 2019 novel coronavirus indicating person-to-person transmission: a study of a family cluster  [published January 24, 2020].  Lancet. 2020;S0140-6736(20)30154-9. doi:
                        <a target="_blank" href="http://dx.doi.org/10.1016/S0140-6736(20)30154-9">10.1016/S0140-6736(20)30154-9</a></p>
                </div>

                <button id="start-over">Start Over</button>
            </div>

            <div class="buttons">
                <button class="next">Next <img src="./img/left.png" class="arrow right"></button>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <a target="_blank" href="./privacy.html">Privacy Policy</a>
    <br>
    Copyright © 2020 UW Innovations
</div>

<script src="./js/jquery-3.3.1.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script>
    var currentStep = 1;
    var isPatient = false;

    $('#step-1').show();
    
    $.ajax({
        url: './ajax/getDate.php',
        type: 'GET',
        dataType: 'json'
    }).done(function (response) {
        $('#last_updated').attr('data-date', response.date);
        $('#last_updated').text(response.dateLong);
    });

    $('#step-1 .answer-btn').click(function () {
        if ($(this).text() == 'Yes – I’m answering these questions for myself') {
            isPatient = false;
            $('#step-2 .step-title').text('2. Are you male or female');
            $('#step-3 .step-title').text('3. What is your age?');
            $('#step-4 .step-title').text('4. Do you have a fever?');
            $('#step-5 .step-title').text('5. Do you have a dry cough?');
            $('#step-6 .step-title').text('6. Do you have shortness of breath?');
        } else {
            isPatient = true;
            $('#step-2 .step-title').text('2. Is the patient male or female?');
            $('#step-3 .step-title').text('3. What is the patient’s age?');
            $('#step-4 .step-title').text('4. Does the patient have a fever?');
            $('#step-5 .step-title').text('5. Does the patient have a dry cough?');
            $('#step-6 .step-title').text('6. Does the patient have shortness of breath?');
        }

        next();
    });

    $('#step-2 .answer-btn, #step-3 .answer-btn').click(function () {
        next();
    });

    $('.answer-btn').click(function () {
        $(this).parent().find('.answer-btn').removeClass('selected-btn');
        $(this).addClass('selected-btn');

        if ($(this).text() == 'Yes' || $(this).text() == 'Maybe') {
            $(this).parent().find('.number').addClass('highlight');
        } else {
            $(this).parent().find('.number').removeClass('highlight');
        }
    });
    
    $(document).keydown(function (e) {
        if (e.keyCode == 13 && currentStep > 3 && currentStep <8) {
            next();
        }
    });

    $('.number').keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter, ctrl+A and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
            // Allow: Ctrl+A
            (e.keyCode == 65 && e.ctrlKey === true) ||
            // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) {
            // let it happen, don't do anything
            return;
        }

        var charValue = String.fromCharCode(e.keyCode);
        var valid = /^[0-9]+$/.test(charValue);

        if (!valid) {
            e.preventDefault();
        }
    });

    $('.next').click(function () {
        next();
    });

    $('.back').click(function () {
        back();
    });

    $('#step-4 .answer-btn:last, #step-5 .answer-btn:last, #step-6 .answer-btn:last').click(function () {
        next();
    });

    $('.infografic').scroll(function () {
        var scrollLeft = $(this).scrollLeft();

        $('.infografic').scrollLeft(scrollLeft);
    });

    $('#step-7 input').eq(9).click(function () {
        if ($(this).is(':checked')) {
            $('#step-7 .radio-wrap input').prop('checked', false);
            $(this).prop('checked', true);
            next();
        }
    });
    
    $('#get-results').click(function () {
        if (!validate()) {
            return;
        }

        var fever = $('#step-4 .selected-btn').text();
        var dryCough = $('#step-5 .selected-btn').text();
        var shortnessOfBreath = $('#step-6 .selected-btn').text();

        var difficultyBreathing = $('#step-7 input').eq(0).is(':checked');
        var persistentPain = $('#step-7 input').eq(1).is(':checked');
        var newConfusion = $('#step-7 input').eq(2).is(':checked');
        var bluishLips = $('#step-7 input').eq(3).is(':checked');
        var achesPains = $('#step-7 input').eq(4).is(':checked');
        var nasalCongestion = $('#step-7 input').eq(5).is(':checked');
        var runnyNose = $('#step-7 input').eq(6).is(':checked');
        var soreThroat = $('#step-7 input').eq(7).is(':checked');
        var diarrhea = $('#step-7 input').eq(8).is(':checked');
        var noneOfAbove = $('#step-7 input').eq(9).is(':checked');


        if (fever == 'No' && dryCough == 'No' && shortnessOfBreath == 'No' && noneOfAbove == true) { // Scenario 1
            $('.infografics').hide();
            $('.scenario-1').show();
        } else if (difficultyBreathing || persistentPain || newConfusion || bluishLips) { // Scenario 2
            var list = '';
            if (difficultyBreathing) {
                list += '<li>Difficulty Breathing</li>';
            }

            if (persistentPain) {
                list += '<li>Persistent pain or pressure in your chest</li>';
            }

            if (newConfusion) {
                list += '<li>New confusion or inability to arouse</li>';
            }

            if (bluishLips) {
                list += '<li>Bluish lips or face</li>';
            }

            $('#result-table tr:nth-child(4) td').eq(1).text('Yes');

            $('.scenario-2 .symptoms').html(list);
            $('.scenario-2').show();

            createInfografic();
            resizeInfografic();
        } else if (fever == 'Yes' || fever == 'Maybe' || dryCough == 'Yes' || dryCough == 'Maybe' || shortnessOfBreath == 'Yes' || shortnessOfBreath == 'Maybe') { // Scenario 3
            var count = 0;
            if (fever == 'Yes' || fever == 'Maybe') {
                count++;
            }
            if (dryCough == 'Yes' || dryCough == 'Maybe') {
                count++;
            }
            if (shortnessOfBreath == 'Yes' || shortnessOfBreath == 'Maybe') {
                count++;
            }

            var numbers = {
                1: 'one',
                2: 'two',
                3: 'three'
            };

            $('.scenario-3 .numbers').text(numbers[count] + ' ('+ count +')');
            $('.scenario-3').show();
            createInfografic();
            resizeInfografic();
        } else {  // Scenario 4
            if (achesPains || nasalCongestion || runnyNose || soreThroat || diarrhea) {
                $('.scenario-4 .other-options').show();
            } else {
                $('.scenario-4 .other-options').hide();
            }

            $('.scenario-4').show();
            createInfografic();
            resizeInfografic();
        }


        //Update table
        $('#result-table tr:nth-child(1) td').eq(1).text(fever);
        $('#result-table tr:nth-child(2) td').eq(1).text(dryCough);
        $('#result-table tr:nth-child(3) td').eq(1).text(shortnessOfBreath);

        if (achesPains || nasalCongestion || runnyNose || soreThroat || diarrhea) {
            $('#result-table tr:nth-child(5) td').eq(1).text('Yes');
            $('#result-table tr:nth-child(5) td .colon').show();

            var list = '';
            if (achesPains) {
                list += '<li>Aches and pains</li>';
            }

            if (nasalCongestion) {
                list += '<li>Nasal congestion</li>';
            }

            if (runnyNose) {
                list += '<li>Runny Nose</li>';
            }

            if (soreThroat) {
                list += '<li>Sore throat</li>';
            }

            if (diarrhea) {
                list += '<li>Diarrhea</li>';
            }

            $('#result-table tr:nth-child(5) ul').html(list);
        } else {
            $('#result-table tr:nth-child(5) td .colon').hide();
        }

        if (isPatient) {
            $('#step-9 .caregiver').hide();
            $('#step-9 .patient').show();
        } else {
            $('#step-9 .caregiver').show();
            $('#step-9 .patient').hide();
        }

        saveData();
        $('.back').hide();
        $('#step-' + currentStep).hide();
        $('#step-9').show();
    });
    
    function createInfografic() {
        var symptomsDays = {};
        var maxDays = 0;
        var otherSymptoms = [];

        var fever = $('#step-4 .selected-btn').text();
        var feverDays = parseInt($('#step-4 .number').val());

        if (feverDays > 0) {
            if (symptomsDays['day-' + feverDays]) {
                symptomsDays['day-' + feverDays].push('Fever');
            } else {
                symptomsDays['day-' + feverDays] = [];
                symptomsDays['day-' + feverDays].push('Fever');
            }
        } else if (fever != 'No') {
            otherSymptoms.push('Fever');
        }

        var dryCough = $('#step-5 .selected-btn').text();
        var dryCoughDays = parseInt($('#step-5 .number').val());

        if (dryCoughDays > 0) {
            if (symptomsDays['day-' + dryCoughDays]) {
                symptomsDays['day-' + dryCoughDays].push('Dry cough');
            } else {
                symptomsDays['day-' + dryCoughDays] = [];
                symptomsDays['day-' + dryCoughDays].push('Dry cough');
            }
        } else if (dryCough != 'No') {
            otherSymptoms.push('Dry cough');
        }

        var shortnessOfBreath = $('#step-6 .selected-btn').text();
        var shortnessOfBreathDays = parseInt($('#step-6 .number').val());

        if (shortnessOfBreathDays > 0) {
            if (symptomsDays['day-' + shortnessOfBreathDays]) {
                symptomsDays['day-' + shortnessOfBreathDays].push('Shortness of breath');
            } else {
                symptomsDays['day-' + shortnessOfBreathDays] = [];
                symptomsDays['day-' + shortnessOfBreathDays].push('Shortness of breath');
            }
        } else if (shortnessOfBreath != 'No') {
            otherSymptoms.push('Shortness of breath');
        }

        var otherSymptomsDays = parseInt($('#step-7 .number').val());

        if (otherSymptomsDays > 0) {
            if (!symptomsDays['day-' + otherSymptomsDays]) {
                symptomsDays['day-' + otherSymptomsDays] = [];
            }

            $('#step-7 .radio-wrap input:checked').each(function () {
                symptomsDays['day-' + otherSymptomsDays].push($(this).next().text());
            });
        } else {
            $('#step-7 .radio-wrap input:checked').each(function () {
                if ($(this).next().text() != 'None of the above') {
                    otherSymptoms.push($(this).next().text());
                }
            });
        }

        if (feverDays > maxDays) {
            maxDays = feverDays;
        }
        if (dryCoughDays > maxDays) {
            maxDays = dryCoughDays;
        }
        if (shortnessOfBreathDays > maxDays) {
            maxDays = shortnessOfBreathDays;
        }
        if (otherSymptomsDays > maxDays) {
            maxDays = otherSymptomsDays;
        }

        var symptomDaysReverse = {};
        for (var key in symptomsDays) {
            var dayAgo = key.split('-');
            dayAgo = dayAgo[1];

            var day = maxDays + 1 - dayAgo;

            if (day > 21) {
                day = 22;
            }

            if (!symptomDaysReverse['day-' + day]) {
                symptomDaysReverse['day-' + day] = [];
            }

            for (var i in symptomsDays[key]) {
                symptomDaysReverse['day-' + day].push(symptomsDays[key][i]);
            }
        }


        if (isPatient) {
            $('#user-infografic table tr').append('<td>Patient</td>');
        } else {
            $('#user-infografic table tr').append('<td>You</td>');
        }

        if (maxDays == 0) {
            maxDays = 9;
        }

        if (maxDays <= 21) {
            for (var i = 0; i < maxDays; i++) {
                $('#user-infografic table tr').append('<td>'+ (i+1) +'</td>');
            }
            $('#user-infografic table tr').append('<td>Today</td>');
        } else {
            for (var i = 0; i < 21; i++) {
                $('#user-infografic table tr').append('<td>'+ (i+1) +'</td>');
            }

            $('#user-infografic table tr').append('<td>...</td>').append('<td>Today</td>');
        }

        var days = Object.keys(symptomDaysReverse).sort(function (a, b) {
            var a = a.split('-')[1];
            var b = b.split('-')[1];

            if (a > b) {
                return 1;
            } else {
                return -1;
            }
        });

        var rows = 0;
        for (var i = days.length - 1; i >= 0; i--) {
            var dayAgo = days[i].split('-');
            dayAgo = dayAgo[1];


            var $text = $('<div class="text"></div>');

            for (var key in symptomDaysReverse['day-' + dayAgo]) {
                $text.append('<div class="line">'+ symptomDaysReverse['day-' + dayAgo][key] +'</div>');
                rows++;
            }

            $text.css({
                left: (150 + (dayAgo - 1) * 30.2 + 15) + 'px',
                height: (rows * 24) + 'px'
            });

            $('#user-infografic .infografic-wrap').prepend($text);
            $('#user-infografic table').css({
                'margin-top': ((rows * 24) + 15) + 'px'
            });
        }

        if (days.length > 0) {
            $('#step-9 .has_not_symptoms').hide();
            $('#step-9 .has_symptoms').show();
        } else {
            $('#step-9 .has_not_symptoms').show();
            $('#step-9 .has_symptoms').hide();
        }

        if (otherSymptoms.length > 0) {
            $('.other-symptoms').text('Other symptoms: ' + otherSymptoms.join(', '));
        }

    }

    function resizeInfografic() {
        setTimeout(function(){
            var maxWidth = 0;
            $('.infografic').each(function () {
                if ($(this).get(0).scrollWidth > maxWidth) {
                    maxWidth = $(this).get(0).scrollWidth;
                }
            });

            $('.infografic .infografic-wrap').css({
                'min-width': maxWidth
            });
        }, 100);

    }
    
    function saveData() {
        var data = {};
        data['patient_or_caregiver'] = $('#step-1 .selected-btn').text();
        data['gender'] = $('#step-2 .selected-btn').text();
        data['age'] = $('#step-3 .selected-btn').text();

        data['fever'] = $('#step-4 .selected-btn').text();
        data['fever_days'] = $('#step-4 input').val();

        data['dry_cough'] = $('#step-5 .selected-btn').text();
        data['dry_cough_days'] = $('#step-5 input').val();

        data['shortness_of_breath'] = $('#step-6 .selected-btn').text();
        data['shortness_of_breath_days'] = $('#step-6 input').val();

        data['difficulty_breathing'] = $('#step-7 input').eq(0).is(':checked') ? 'Yes' : 'No';
        data['pain_in_chest'] = $('#step-7 input').eq(1).is(':checked') ? 'Yes' : 'No';
        data['new_confusion'] = $('#step-7 input').eq(2).is(':checked') ? 'Yes' : 'No';
        data['bluish_lips_face'] = $('#step-7 input').eq(3).is(':checked') ? 'Yes' : 'No';
        data['aches_and_pains'] = $('#step-7 input').eq(4).is(':checked') ? 'Yes' : 'No';
        data['nasal_congestion'] = $('#step-7 input').eq(5).is(':checked') ? 'Yes' : 'No';
        data['runny_nose'] = $('#step-7 input').eq(6).is(':checked') ? 'Yes' : 'No';
        data['sore_throat'] = $('#step-7 input').eq(7).is(':checked') ? 'Yes' : 'No';
        data['diarrhea'] = $('#step-7 input').eq(8).is(':checked') ? 'Yes' : 'No';
        data['other_symptoms_days'] = $('#step-7 input:last-child').val();

        data['comments'] = $('#comments').val();
//        data['email'] = $('#email').val();
        data['version'] = 1;
        data['version_last_updated'] = $('#last_updated').attr('data-date');

        $.ajax({
            url: "./ajax/saveAnswers.php",
            type: "POST",
            data: data,
            dataType: 'json',
            cache: false
        });
    }

    $('#start-over').click(function () {
        $('.selected-btn').removeClass('selected-btn');
        $('.radio-wrap input').prop("checked", false);
        $('input.number').val('').removeClass('highlight');
        $('#comments').val('');
//        $('#email').val('');
        $('#result-table ul').html('');
        $('#result-table tr td:last-child').text('No');
        $('.scenario-1, .scenario-2, .scenario-3, .scenario-4').hide();
        $('#user-infografic table tr').html('');
        $('#user-infografic .text').remove();
        $('.other-symptoms').text('');

        currentStep = 1;
        $('.step').hide();
        $('#step-1').show();
    });

    function next() {
        if (!validate()) {
            return;
        }

        if (currentStep == 1) {
            $('.back').show();
            $('h1').hide();
            $('.description').hide();
            $('.buttons').css('margin-top', '70px');
        }

        if (currentStep == 7) {
            $('.next').hide();
        }

        if (currentStep == 3) {
            $('.next').show();
        }


        $('#step-' + currentStep).hide();
        currentStep++;
        $('#step-' + currentStep).show();
        $(window).scrollTop(0);
    }
    
    function back() {
        if (currentStep == 2) {
            $('.back').hide();
            $('h1').show();
            $('.description').show();
            $('.buttons').css('margin-top', '30px');
        }

        if (currentStep == 4) {
            $('.next').hide();
        }

        if (currentStep == 8) {
            $('.next').show();
        }

        $('#step-' + currentStep).hide();
        currentStep--;
        $('#step-' + currentStep).show();
    }

    function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }

    function validate() {
        if (currentStep == 4 || currentStep == 5 || currentStep == 6) {
            if ($('#step-' + currentStep + ' .selected-btn').length == 0) {
                $('#error').text('Select the answer').show();
                return false;
            }
        }

//        if (currentStep == 8) {
//            if ($('#comments').val() == '') {
//                $('#error').text('Write a comment').show();
//                return false;
//            }

//            var email = $('#email').val();
//            if (email != '' && !validateEmail(email)) {
//                $('#error').text('Enter a valid email').show();
//                return false;
//            }
//        }

        $('#error').hide();
        return true;
    }

</script>
</body>
</html>